{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///home/ege/WineStorage/wine-next/app/actions.ts"],"sourcesContent":["'use server';\n\nimport * as mongoDB from \"mongodb\";\nimport { sub } from 'date-fns';\nimport { revalidatePath } from \"next/cache\";\nimport axios from \"axios\";\n\n// now longer via mongodb, but kept for reference\nconst client = new mongoDB.MongoClient(\"mongodb://blitz:27017\");\nlet db: mongoDB.Db | null = null;\n// REST access to pioneer wine cellar temperature logger\nlet range: string = \"day\";\nlet degree: string = \"fahrenheit\";\n\ninterface Item {\n    time: string;\n    temp: number;\n}\nlet temps: Item[] = [];\n\nasync function connect() {\n    await client.connect();\n    db = client.db(\"wine\");\n    // console.log(\"Connected to MongoDB\");\n}\n\nexport async function getTemps() {\n    // call pione REST API for sqlite temp data\n    var resp = await axios.get('http://pione:3000/oldTemps/' + `?range=${range}`)\n    // console.log(resp.data);\n    var temps: Item[] = [];\n    resp.data.forEach((doc: any) => {\n        // console.log('at: ', doc.date, ': ', doc.value);\n        temps.push({ time: doc.date, temp: degree == 'celsius' ? doc.value : ((doc.value * 9 / 5) + 32) });\n    });\n    return { temps: temps, degree: degree, range: range };\n}\n\nexport async function setRange(newRange: string) {\n    range = newRange;\n    // console.log(\"Range set to \", range);\n    revalidatePath(\"/\");\n}\nexport async function setDegree(newDegree: string) {\n    degree = newDegree;\n    // console.log(\"Degree set to \", degree);\n    revalidatePath(\"/\");\n}\nexport async function update() {\n    // check whether we need to fetch new data\n    if (!db) {\n        await connect();\n    }\n    var lastEntry = await db!.collection(\"temps\").findOne({}, { sort: [[\"time\", -1]] });\n    var lastTime = lastEntry ? lastEntry.time : new Date(0);\n    var now = new Date();\n    var diffMins = (now.getTime() - lastTime.getTime()) / (1000 * 60);\n    console.log('Minutes since last entry: ', diffMins);\n\n}"],"names":[],"mappings":";;;;;;;;;;;AAEA;AAEA;AACA;;;;;;AAEA,iDAAiD;AACjD,MAAM,SAAS,IAAI,sHAAmB,CAAC;AACvC,IAAI,KAAwB;AAC5B,wDAAwD;AACxD,IAAI,QAAgB;AACpB,IAAI,SAAiB;AAMrB,IAAI,QAAgB,EAAE;AAEtB,eAAe;IACX,MAAM,OAAO,OAAO;IACpB,KAAK,OAAO,EAAE,CAAC;AACf,uCAAuC;AAC3C;AAEO,eAAe;IAClB,2CAA2C;IAC3C,IAAI,OAAO,MAAM,gJAAK,CAAC,GAAG,CAAC,gCAAgC,CAAC,OAAO,EAAE,OAAO;IAC5E,0BAA0B;IAC1B,IAAI,QAAgB,EAAE;IACtB,KAAK,IAAI,CAAC,OAAO,CAAC,CAAC;QACf,kDAAkD;QAClD,MAAM,IAAI,CAAC;YAAE,MAAM,IAAI,IAAI;YAAE,MAAM,UAAU,YAAY,IAAI,KAAK,GAAI,AAAC,IAAI,KAAK,GAAG,IAAI,IAAK;QAAI;IACpG;IACA,OAAO;QAAE,OAAO;QAAO,QAAQ;QAAQ,OAAO;IAAM;AACxD;AAEO,eAAe,SAAS,QAAgB;IAC3C,QAAQ;IACR,uCAAuC;IACvC,IAAA,+IAAc,EAAC;AACnB;AACO,eAAe,UAAU,SAAiB;IAC7C,SAAS;IACT,yCAAyC;IACzC,IAAA,+IAAc,EAAC;AACnB;AACO,eAAe;IAClB,0CAA0C;IAC1C,IAAI,CAAC,IAAI;QACL,MAAM;IACV;IACA,IAAI,YAAY,MAAM,GAAI,UAAU,CAAC,SAAS,OAAO,CAAC,CAAC,GAAG;QAAE,MAAM;YAAC;gBAAC;gBAAQ,CAAC;aAAE;SAAC;IAAC;IACjF,IAAI,WAAW,YAAY,UAAU,IAAI,GAAG,IAAI,KAAK;IACrD,IAAI,MAAM,IAAI;IACd,IAAI,WAAW,CAAC,IAAI,OAAO,KAAK,SAAS,OAAO,EAAE,IAAI,CAAC,OAAO,EAAE;IAChE,QAAQ,GAAG,CAAC,8BAA8B;AAE9C;;;IAjCsB;IAYA;IAKA;IAKA;;AAtBA,+OAAA;AAYA,+OAAA;AAKA,+OAAA;AAKA,+OAAA","debugId":null}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///home/ege/WineStorage/wine-next/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {update as '0063d7fa46094d718f1fd21ffff72673ea49887914'} from 'ACTIONS_MODULE0'\nexport {getTemps as '00859568fc1f613f18f184485b910f9b47fbc62a56'} from 'ACTIONS_MODULE0'\nexport {setRange as '4049ad5e84d3cb88990325cbe4482b37b922797054'} from 'ACTIONS_MODULE0'\nexport {setDegree as '406a2a2be179cfe3eb67b6b88631ee01e4da258561'} from 'ACTIONS_MODULE0'\nexport {setRange as '4049ad5e84d3cb88990325cbe4482b37b922797054'} from 'ACTIONS_MODULE0'\nexport {setDegree as '406a2a2be179cfe3eb67b6b88631ee01e4da258561'} from 'ACTIONS_MODULE0'\nexport {update as '0063d7fa46094d718f1fd21ffff72673ea49887914'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}}]
}